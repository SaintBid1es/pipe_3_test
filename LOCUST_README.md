# Нагрузочное тестирование с Locust

## Описание

Этот проект содержит нагрузочные тесты для веб-приложения на Spring Boot с использованием Locust и Faker для генерации тестовых данных.

## Требования

- Python 3.8+
- Locust 2.17+
- Faker 19.0+
- Запущенное Spring Boot приложение на порту 8888

## Установка зависимостей

```bash
pip install -r requirements.txt
```

## Структура тестов

### TaskSet vs SequentialTaskSet

**TaskSet (`ReadOnlyTasks`)**:
- Задачи выполняются **случайным образом** согласно их весам (`@task(вес)`)
- Подходит для операций, порядок которых не важен (например, GET запросы)
- В `ReadOnlyTasks` содержится 11 различных GET задач с весами от 5 до 25

**SequentialTaskSet (`WriteTasks`, `UpdateDeleteTasks`)**:
- Задачи выполняются **последовательно** в порядке объявления
- Подходит для операций, где порядок важен (POST → PUT → DELETE)
- В `WriteTasks` содержится 3 POST задачи, которые выполняются последовательно
- В `UpdateDeleteTasks` содержится 2 PUT задачи

### Задачи в тестах

Всего реализовано **более 15 различных задач**:

#### GET запросы (ReadOnlyTasks):
1. `get_all_products` - получить список всех товаров (вес 25)
2. `get_all_categories` - получить список всех категорий (вес 25)
3. `get_all_customers` - получить список всех клиентов (вес 20)
4. `get_products_page` - товары с пагинацией (вес 15)
5. `get_categories_page` - категории с пагинацией (вес 15)
6. `search_products` - поиск товаров по названию (вес 10)
7. `search_customers` - поиск клиентов (вес 10)
8. `get_orders` - получить список заказов (вес 10)
9. `get_product_by_id` - получить товар по ID (вес 5)
10. `get_category_by_id` - получить категорию по ID (вес 5)

#### POST запросы (WriteTasks - SequentialTaskSet):
11. `create_category` - создать новую категорию
12. `create_product` - создать новый товар
13. `register_customer` - регистрация нового клиента

#### PUT запросы (UpdateDeleteTasks - SequentialTaskSet):
14. `update_product` - обновить товар
15. `update_category` - обновить категорию

### Соотношение GET:POST = 5:1

Соотношение контролируется через:
- Веса TaskSet в классе `ApiUser`: `ReadOnlyTasks` (вес 5) vs `WriteTasks` (вес 1)
- Внутри `ReadOnlyTasks` все GET задачи имеют высокие веса (5-25), что обеспечивает их частое выполнение
- Внутри `WriteTasks` POST задачи выполняются последовательно, но сам TaskSet выбирается реже

### Генерация тестовых данных

Все тестовые данные генерируются с помощью библиотеки **Faker** с локалью `ru_RU`:
- Имена пользователей: `fake.first_name()`, `fake.last_name()`
- Email: `fake.unique.email()`
- Usernames: `fake.user_name() + random_number`
- Названия товаров: `fake.sentence()`
- Описания: `fake.text()`
- Цены: `random.uniform(100.0, 10000.0)`
- Поисковые запросы: `fake.word()`, `fake.first_name()`

## Запуск тестов

### 1. Запуск через веб-интерфейс (рекомендуется)

```bash
locust
```

Затем откройте браузер и перейдите на `http://localhost:8089`

В веб-интерфейсе:
- Укажите количество пользователей (Number of users)
- Укажите скорость спавна (Spawn rate)
- Нажмите "Start swarming"

### 2. Запуск без веб-интерфейса (headless режим)

```bash
locust --headless -u 10 -r 2 -t 1m --host http://localhost:8888
```

Где:
- `-u 10` - 10 пользователей
- `-r 2` - скорость спавна 2 пользователя в секунду
- `-t 1m` - время тестирования 1 минута
- `--host` - URL приложения

### 3. Сохранение результатов в файл

```bash
locust --headless -u 10 -r 2 -t 1m --host http://localhost:8888 --html report.html
```

## Настройка аутентификации

По умолчанию тесты используют следующие учетные данные:
- Username: `admin`
- Password: `admin123`

**ВАЖНО**: Убедитесь, что эти учетные данные существуют в вашей базе данных, или измените их в методах `on_start()` классов `ReadOnlyTasks`, `WriteTasks`, `UpdateDeleteTasks`.

## Интерпретация результатов

После завершения тестирования вы увидите:
- **Request**: Название запроса
- **# Requests**: Количество выполненных запросов
- **# Fails**: Количество неудачных запросов
- **Median, 95%, 99%**: Время отклика в миллисекундах
- **Average**: Среднее время отклика
- **Min/Max**: Минимальное и максимальное время отклика
- **RPS**: Запросов в секунду

**Ожидаемые результаты**:
- GET запросы должны выполняться примерно в 5 раз чаще, чем POST
- Большинство запросов должны быть успешными (не все Fail)
- Время отклика должно быть разумным (зависит от производительности сервера)

## Устранение проблем

### Все запросы возвращают 401 (Unauthorized)
- Проверьте учетные данные в `on_start()` методах
- Убедитесь, что пользователь `admin` существует в базе данных

### Все запросы возвращают 404 (Not Found)
- Проверьте, что приложение запущено на `http://localhost:8888`
- Проверьте правильность путей API

### Все запросы возвращают 500 (Internal Server Error)
- Проверьте логи приложения Spring Boot
- Убедитесь, что база данных подключена и работает

## Дополнительная информация

- Документация Locust: https://docs.locust.io/
- Документация Faker: https://faker.readthedocs.io/

